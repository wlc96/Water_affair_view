<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<!-- Bootstrap core CSS -->
		<link href="public/bootstrap.min.css" title="" rel="stylesheet" />
		<link rel="stylesheet" href="css/plugins/toastr/toastr.min.css" />
		<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
		<link href="public/animate.css" rel="stylesheet">
		<link rel="stylesheet" href="public/inspinia.css" />
		<!-- <link rel="stylesheet" href="css/my_TiBaoJiLu.css" /> -->
		<link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
		<link rel="stylesheet" href="public/public.css">
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		    <script src="public/html5shiv.min.js"></script>
		    <script src="public/respond.min.js"></script>
		<![endif]-->
		<style>
			.totalData{
				overflow: hidden;
			}
			.dataList,.dataList li{
				margin:0;
				padding:0;
				list-style: none;
			}
			.dataList li{
				overflow: hidden;
				padding:12px 0;
				background: #fff;
				width: 12.15%;
				float: left;
				margin-right: 0.4%;
				display: flex;
				align-items: center;
				border:1px solid #E5E5E5;
				box-shadow: 0px 0px 10px 3px #eff1f5;
				border-radius: 6px;
			}
			.dataList li:last-child{
				margin-right: 0;
			}
			.imgIns{
				width: 40%;
				float: left;
				text-align: center;
			}
			.imgIns img{
				width: 64%;
			}
			.insBox{
				width: 60%;
				float: right;
				text-align: center;
			}
			.insBox span{
				font-size: 24px;
				color:#666666;
			}
			.insBox p{
				font-size: 12px;
				color:#959595;
			}
			.lookMore .fa{
				color:#8998A4;
			}
			.lookMore .fa:hover{
				color:#2ECDBA;
			}
			.sbState{
				display: inline-block;
			}
			.sbState,.sbState li{
				margin:0;
				padding:0;
				list-style: none;
			}
			.sbState li{
				float: left;
				margin:0px 10px;
			}
			span.colorCircle{
				display: inline-block;
				width: 12px;
				height: 12px;
				border-radius: 50%;
				position: relative;
				top:1px;
				margin-right: 8px;
			}
			span.stateName{
				display: inline-block;
				width: 40px;
			}
			span.stateCon{
				display: inline-block;
				width: 40px;
			}
			span.green{
				background: #2ACDB8;
			}
			span.gray{
				background: #8796A3;
			}
			span.red{
				background: #F55F6E;
			}
		</style>
		<title>总览</title>
	</head>

	<body>
		<div id="wrapper">
			<!--标编辑-->
			<div id="biaobj" class=" wrapper wrapper-content animated fadeInRight">
				<div class="totalData">
					<ul class="dataList">
						<li>
							<div class="imgIns">
								<img src="img/device01.png" alt="">
							</div>
							<div class="insBox">
								<span class="eq_sum">22</span>
								<p>总表数</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device02.png" alt="">
							</div>
							<div class="insBox">
								<span class="big_eq_sum">0</span>
								<p>大口径水表</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device03.png" alt="">
							</div>
							<div class="insBox">
								<span class="lit_eq_sum">0</span>
								<p>小口径水表</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device04.png" alt="">
							</div>
							<div class="insBox">
								<span>27.5</span>
								<p>总用水量</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device05.png" alt="">
							</div>
							<div class="insBox">
								<span class="open_num">0</span>
								<p>阀门打开</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device06.png" alt="">
							</div>
							<div class="insBox">
								<span class="close_num">0</span>
								<p>阀门关闭</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device07.png" alt="">
							</div>
							<div class="insBox">
								<span class="fault_num">0</span>
								<p>故障</p>
							</div>
						</li>
						<li>
							<div class="imgIns">
								<img src="img/device08.png" alt="">
							</div>
							<div class="insBox">
								<span class="Off_line_num">0</span>
								<p>离线</p>
							</div>
						</li>
					</ul>
				</div>
				<!--表格部分-->
				<div class="ibox-content">
					<div class="searchBox">
						<form action="" class="form-horizontal">
							<div class="form-group">
								<label for="">查询</label>
								<div class="searchInput" style="margin-right: 20px;">
									<input type="text" placeholder="输入分布区名称" class="form-control fenBu">
									<img src="img/look.png" alt="">
								</div>
								<button type="button" class="btn btn-primary searchCon">查询</button>
							</div>
						</form>
					</div>
					<div class="tableSec">
						<table id="dataTable" class="table table-bordered table-hover">
							<thead>
								<tr>
									<th>序号</th>
									<th>水表分布区名称</th>
									<th>总水量（吨）</th>
									<!-- <th>总表数</th> -->
									<th>今日用水量</th>
									<th>当前水表状态</th>
									<th>查看明细</th>
								</tr>
							</thead>
							<tbody>
								<!-- <tr>
										<td>1</td>
										<td>西城嘉和小区营业点</td>
										<td>268.00</td>
										<td>5</td>
										<td>22.00</td>
										<td>
											<ul class="sbState">
												<li>
													<span class="colorCircle green"></span>
													打开：23
												</li>
												<li>
													<span class="colorCircle gray"></span>
													关闭：12
												</li>
												<li>
													<span class="colorCircle red"></span>
													故障：4
												</li>
											</ul>
										</td>
										<td>
											<a class="lookMore" href="javascript:void(0)">
												<span class="fa fa-search"></span>
											</a>
										</td>
									</tr> -->
							</tbody>
						</table>
					</div>
					<div class="footIns">
						<div class="selectNum">
							当前显示
							<select name="" id="" class="selNum">
								<option value="5">5</option>
								<option value="10">10</option>
								<option value="25">25</option>
							</select>
							项结果
						</div>
						<ul id="page"></ul>
					</div>
				</div>
			</div>
		</div>
		<script src="public/jquery-1.11.3.js"></script>
		<script src="public/bootstrap.min.js" type="text/javascript"></script>
		<!-- <script src="js/plugins/lhgdialog/lhgdialog.js"></script> -->
		<!-- 弹出警示框 -->
		<script src="js/plugins/toastr/toastr.min.js"></script>

		<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
		<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
		<script src="js/plugins/dataTables/datatables.min.js"></script>
		<!-- 页码 -->
		<script src="js/bootstrap-paginator.js" type="text/javascript"></script>
		<!-- 全局js -->
		<script src="js/global.js" type="text/javascript" charset="utf-8"></script>
		<!-- 引入请求数据方法 -->
		<script src="js/api.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/http.js"></script>
		<script>
			var defaultNum = 5;
			var table;

			$(function() {
				//初始化页码
				initPage(defaultNum);
			})

			$("#dataTable").on("click", ".lookMore", function() {
				var currentId = $(this).attr("data-id");
				parent.$("#ifr").attr("src", "deviceDetail.html?id=" + currentId);
			})
			$(".searchCon").click(function() {
				var inner = $(this).siblings(".searchInput").find("input").val();
				initPage(defaultNum, inner);
			})
			//初始化页码
			function initPage(defaultNum, name) {
				name = arguments[1] ? arguments[1] : " ";
				$(".selNum").find('option[value="' + defaultNum + '"]').prop("selected", true);
				
				$.ajax({
					type: "POST",
					url: ApiUrl + global_url.stationList,
					cache: false, //禁用缓存
					data: {
						pre_page: defaultNum,
						name: name
					}, //传入组装的参数
					contentType: "application/x-www-form-urlencoded;",
					dataType: "json",
					beforeSend: function(xhr) {
						xhr.setRequestHeader('access-token', localStorage.getItem("access-token"));
					},
					success: function(result) {
						// console.log("11111111111111111"+JSON.stringify(result));
						if (result.result) {
							//初始化表格数据
							initTableData(defaultNum, name);
							//渲染页码
							var currentPage = 1;
							var totalPages = result.data.list.last_page;
							
							$("#page").bootstrapPaginator({
								bootstrapMajorVersion: 3, //对应的bootstrap版本
								currentPage: currentPage, //当前页数
								numberOfPages: 10, //每次显示页数
								totalPages: totalPages, //总页数
								shouldShowPage: true, //是否显示该按钮
								useBootstrapTooltip: true,
								//分页点击事件
								onPageClicked: function(event, originalEvent, type, page) {
									console.log(ApiUrl + global_url.stationList + "?page=" + page);
									//点击分页重载表格
									table.ajax.url(ApiUrl + global_url.stationList + "?page=" + page).load();
								}
							});
						}
					}
				});
			}
			//初始化表格
			function initTableData(defaultNum, name) {
				name = arguments[1] ? arguments[1] : " ";
				table = $('#dataTable').DataTable({
					paging: false,
					pageLength: 10,
					responsive: true,
					destroy: true,
					bAutoWidth: false,
					lengthMenu: [5, 10, 25, 50, ],
					bFilter: false,
					sPaginationType: "full_numbers",
					bLengthChange: true,
					ordering: false,
					info: false,
					sDom: '<"top"<"clear">>rt<"bottom"lfip<"clear">>',
					language: {
						"sProcessing": "处理中...",
						"sLengthMenu": "显示 _MENU_ 项结果",
						"sZeroRecords": "没有匹配结果",
						// "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
						"sInfo": "共 _TOTAL_ 项",
						"sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
						"sInfoFiltered": "(由 _MAX_ 项结果过滤)",
						"sInfoPostFix": "",
						"sSearch": "搜索:",
						"sUrl": "",
						"sEmptyTable": "表中数据为空",
						"sLoadingRecords": "载入中...",
						"sInfoThousands": ",",
						"oPaginate": {
							"sFirst": "首页",
							"sPrevious": "上页",
							"sNext": "下页",
							"sLast": "末页"
						},
						"oAria": {
							"sSortAscending": ": 以升序排列此列",
							"sSortDescending": ": 以降序排列此列"
						}
					},
					ajax: {
						url: ApiUrl + global_url.stationList,
						type: "POST",
						contentType: "application/x-www-form-urlencoded",
						beforeSend: function(xhr) {
							xhr.setRequestHeader('access-token', localStorage.getItem("access-token"));
						},
						data: function(obj) {
							obj.pre_page = defaultNum;
							obj.name = name;
						},
						dataSrc: function(json) {
							console.log("获取到的站点信息列表的数据：" + JSON.stringify(json) + "========>" + name);
							for (var k in json.data) {
								$("span." + k).html(json.data[k]);
							}
							return json.data.list.data;
						}
					},
					fnServerParams: function(aoData) { //这个里面的 aoData就是会发送到后端的数据
						//在这里 你可以对 发送到后端之前做任何事情. 
						// aoData._rand = Math.random();
						console.log(aoData);
					},
					columns: [{
						render: function(data, type, row, meta) {
							return meta.row + meta.settings._iDisplayStart + 1;
						}
					}, {
						data: 'name'
					}, {
						data: 'sum_num'
					}, {
						data: 'today_num'
					}, {
						render: function(data, type, row) {
							var html = '';
							html = '<ul class="sbState">' +
								'<li>' +
								'<span class="colorCircle green"></span>' +
								'<span class="stateName">打开：</span><span class="stateCon">' + row.open_num + '</span>'+
								'</li>' +
								'<li>' +
								'<span class="colorCircle gray"></span>' +
								'<span class="stateName">关闭：</span><span class="stateCon">' + row.close_num + '</span>'+
								'</li>' +
								'<li>' +
								'<span class="colorCircle red"></span>' +
								'<span class="stateName">故障：</span><span class="stateCon">' + row.fault_num + '</span>'+
								'</li>' +
								'</ul>';
							return html;
						}
					}, {
						render: function(data, type, row) {
							var html = '';
							html = '<a class="lookMore" data-id="' + row.id + '" href="javascript:void(0)">' +
								'<span class="fa fa-search"></span>' +
								'</a>';
							return html;
						}
					}],
					buttons: [{
							extend: 'copy',
							className: 'copyButton',
							text: "复制"
						},
						{
							extend: 'excel',
							className: 'excelButton',
							text: "导出excel",
							title: 'ExampleFile'
						},
						{
							extend: 'pdf',
							className: 'pdfButton',
							text: "导出pdf",
							title: 'ExampleFile'
						},
						{
							extend: 'print',
							className: 'printButton',
							text: "打印",
							customize: function(win) {
								$(win.document.body).addClass('white-bg');
								$(win.document.body).css('font-size', '10px');

								$(win.document.body).find('table')
									.addClass('compact')
									.css('font-size', 'inherit');
							}
						}
					],
					fnCreatedRow: function(nRow, aData, iDataIndex) { //将id绑定在tr
						if (typeof(aData.id) != "undefined") {
							$(nRow).attr("tr_id", aData.id);
						}
					}
				});
			}
			//选择每页显示条数
			$(".selNum").change(function() {
				var num = $(this).find("option:checked").val();
				defaultNum = num;
				//初始化页码
				initPage(defaultNum);
			})
		</script>
	</body>
</html>
